# Ralph Configuration
# Supports multiple AI agent CLIs: Cursor, Claude

[agent]
# Which agent to use: "cursor" or "claude"
provider = "cursor"

# Cursor CLI configuration
# See: https://cursor.com/docs/cli/overview
[agent.cursor]
# Path to the Cursor agent CLI
# - Default: "agent" (standard Cursor CLI installation)
# - NixOS: "cursor-agent"
# - Custom: "/path/to/agent"
path = "agent"

# Model to use (optional, uses Cursor's default if not set)
# model = "claude-sonnet-4-20250514"

# Output format for non-interactive mode
output_format = "text"

# Sandbox mode for cursor-agent (required for autonomous validation)
# Options: "disabled" (default), "enabled"
sandbox = "disabled"

# Claude Code CLI configuration
# See: https://docs.anthropic.com/en/docs/claude-code
[agent.claude]
# Path to the Claude CLI
path = "claude"

# Model to use (optional)
# model = "opus"

# Skip permission prompts (required for autonomous operation)
skip_permissions = true

# Output format
output_format = "stream-json"

# Verbose output
verbose = false

[sandbox]
# Enable Docker sandboxing for isolation
enabled = true

# Docker image to use
# Build with: ralph image build (uses Nix by default)
# Or legacy: ralph image build --dockerfile Dockerfile
image = "ralph:latest"

# Reuse container between iterations (faster startup)
reuse_container = false

# Prefer local image over pulling from registry
# When true, `ralph image pull` checks for local image first
use_local_image = true

# Additional volume mounts (read-only by default)
# mounts = [
#     { host = "~/.npm", container = "/root/.npm", readonly = false },
# ]

# Credential auto-mounts (defaults shown, set to [] to disable)
# credential_mounts = [
#     { host = "~/.ssh", container = "/root/.ssh", readonly = true },
#     { host = "~/.gitconfig", container = "/root/.gitconfig", readonly = true },
#     { host = "~/.npmrc", container = "/root/.npmrc", readonly = true },
#     { host = "~/.cargo/credentials.toml", container = "/root/.cargo/credentials.toml", readonly = true },
#     { host = "~/.pypirc", container = "/root/.pypirc", readonly = true },
# ]

[sandbox.network]
# Network policy: "allow-all", "allowlist", "deny"
# Default: allow-all for ease of use; tighten per-project as needed
policy = "allow-all"

# Allowed domains when policy = "allowlist"
# allowed = [
#     "github.com",
#     "gitlab.com",
#     "registry.npmjs.org",
#     "pypi.org",
#     "crates.io",
#     "api.anthropic.com",
#     "api.openai.com",
# ]

# Custom DNS servers
dns = ["8.8.8.8", "1.1.1.1"]

[sandbox.resources]
# Resource limits
memory = "8g"
cpus = "4"
timeout_minutes = 60

[git]
# Auto-push after each iteration
auto_push = true

# Protected branches (ralph cannot force-push to these)
protected_branches = ["main", "master", "production"]

[completion]
# Number of consecutive idle iterations before stopping.
# An iteration is "idle" if validation passes but no new commits are created.
# Default: 2
idle_threshold = 2

[monitoring]
# Log file location
log_file = ".ralph/loop.log"
# Log format: "json" or "text"
log_format = "json"
# Log rotation: "daily" (default), "hourly", "never"
log_rotation = "daily"
# Show progress during loop execution
show_progress = true
# Circuit breaker: stop after N consecutive errors (0 = disabled)
max_consecutive_errors = 5

# Notification configuration
# [monitoring.notifications]
# on_complete = "https://hooks.example.com/ralph"  # Webhook URL
# on_error = "desktop"  # Options: "webhook:<url>", "desktop", "sound", "none"

[validation]
# Enable code validation after each iteration
# Default: true
enabled = true

# Validation command to run
# Can be a single command or space-separated command with arguments
# Examples:
#   - "nix flake check --quiet" (default, recommended for Nix projects)
#   - "nix flake check" (verbose, shows all build output)
#   - "cargo check"
#   - "cargo test"
#   - "./validate.sh"
# Default: "nix flake check --quiet"
command = "nix flake check --quiet"
